<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JIAICB (V0.73)</title>
<style>
  body { font-family: sans-serif; background: #111; color: #eee; margin: 0; display: flex; flex-direction: column; height: 100vh; transition: background 0.4s, color 0.4s; }
  #chat { flex: 1; padding: 1em; overflow-y: auto; background: #222; border-bottom: 1px solid #333; text-align: left; transition: background 0.4s; }
  .message { display: block; padding: 0.5em 1em; border-radius: 15px; margin: 0.25em 0; max-width: 70%; word-wrap: break-word; position: relative; opacity:0; transform: translateY(10px); transition: opacity 0.3s, transform 0.3s; }
  .user { align-self: flex-end; background: #6272a4; color: #fff; text-align: left; }
  .ai { align-self: flex-start; background: #50fa7b; color: #111; text-align: left; }
  .system { text-align: left; font-style: italic; color: #ff5555; }
  .messageText { display: block; margin-top: 0.25em; }
  #inputArea { display: flex; padding: .5em; background: #111; }
  #prompt { flex: 1; padding: .5em; background: #222; color: #fff; border: 1px solid #444; border-radius: 5px; transition: background 0.4s, color 0.4s; }
  button { margin-left: .5em; padding: .5em 1em; border: none; border-radius: 5px; background: #6272a4; color: #fff; cursor: pointer; transition: background 0.3s; }
  button:hover { background: #7082c4; }
  #clearMemory { background: red; color: white; }
  #historyBtn { background: #ffee8c; color: black; }
  #historyFrame { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); width:95%; height:80%; border:2px solid #50fa7b; background:#111; color:white; overflow-y:auto; z-index:9999; }
  #closeHistory { display:none; position:fixed; top:5%; right:5%; z-index:10000; padding:.5em 1em; border:none; border-radius:5px; background:#ff5555; color:white; cursor:pointer; }
  #searchBar { padding: 0.5em; margin: 0.5em; width: 80%; border-radius: 5px; border: 1px solid #444; background: #222; color: #fff; }
  /* Custom Theme Modal */
  #customThemeModal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
    background:#111; color:#fff; border:2px solid #50fa7b; border-radius:15px;
    padding:1em; z-index:10000; width:350px; max-height:80%; overflow-y:auto; box-shadow:0 0 20px #50fa7b;
  }
</style>
</head>
<body>

<button id="modsbtn" style="margin-left:10px;">Custom Themes</button>

<!-- Custom Theme Modal -->
<div id="customThemeModal">
  <h3 style="text-align:center;">V1.0 Custom Theme Creator</h3>
  <label>Background:</label><input type="color" id="bgColor" value="#111"><br><br>
  <label>Chat Background:</label><input type="color" id="chatBgColor" value="#222"><br><br>
  <label>User Bubble:</label><input type="color" id="userColor" value="#6272a4"><br><br>
  <label>AI Bubble:</label><input type="color" id="aiColor" value="#50fa7b"><br><br>
  <label>System Text:</label><input type="color" id="systemColor" value="#ff5555"><br><br>

  <h4>Saved Themes</h4>
  <ul id="customThemeList" style="list-style:none; padding:5px; max-height:150px; overflow-y:auto; border:1px solid #444; border-radius:5px;"></ul>

  <div style="text-align:center; margin-top:10px;">
    <button id="previewTheme">Preview</button>
    <button id="saveTheme">Save</button>
    <button id="exportThemeBtn" style="background:#00bfff;color:white;margin-top:5px;">Export Theme</button>
    <button id="importThemeBtn" style="background:#50fa7b;color:white;margin-top:5px;">Import Theme</button>
    <input type="file" id="importThemeFile" accept=".json" style="display:none;">
    <button id="closeTheme" style="background:#ff5555;color:white;">Close</button>
  </div>
</div>

<input id="searchBar" type="text" placeholder="Search messages..." />
<select id="themeSelector">
  <optgroup label="Classic Themes">
    <option value="dark">Dark</option>
    <option value="light">Light</option>
    <option value="sunset">Sunset</option>
  </optgroup>
  <optgroup label="Color Themes">
    <option value="red">Red</option>
    <option value="orange">Orange</option>
    <option value="yellow">Yellow</option>
    <option value="green">Green</option>
    <option value="teal">Teal</option>
    <option value="blue">Blue</option>
    <option value="purple">Purple</option>
    <option value="pink">Pink</option>
  </optgroup>
</select>

<div id="chat"></div>

<div id="inputArea">
  <input id="prompt" type="text" placeholder="Type your message..." autocomplete="off" />
  <button id="sendBtn">Send</button>
  <button id="clearMemory">Clear Memory</button>
  <button id="historyBtn">History</button>
  <button id="importChatBtn" style="background:#50fa7b;color:#111;">Import Chat</button>
  <input type="file" id="importChatFile" accept=".json" style="display:none;">
</div>

<iframe id="historyFrame"></iframe>
<button id="closeHistory">Close History</button>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const themeSelector = document.getElementById("themeSelector");
  const modsBtn = document.getElementById("modsbtn");
  const root = document.documentElement;
  const typingIndicator = document.getElementById("typing");
  const chatBox = document.getElementById("chatBox");

  let customThemes = JSON.parse(localStorage.getItem("customThemes") || "[]");

  // === THEMES ===
  const themes = {
    default: {
      "--bg": "#ffffff",
      "--text": "#000000",
      "--user-bubble": "#e0e0e0",
      "--ai-bubble": "#d0f0ff"
    },
    dark: {
      "--bg": "#121212",
      "--text": "#ffffff",
      "--user-bubble": "#333333",
      "--ai-bubble": "#444444"
    },
    red: {
      "--bg": "#2a0000",
      "--text": "#ffaaaa",
      "--user-bubble": "#660000",
      "--ai-bubble": "#990000"
    },
    blue: {
      "--bg": "#001f3f",
      "--text": "#aaddff",
      "--user-bubble": "#003366",
      "--ai-bubble": "#004080"
    },
    green: {
      "--bg": "#002a00",
      "--text": "#aaffaa",
      "--user-bubble": "#004d00",
      "--ai-bubble": "#006600"
    },
    purple: {
      "--bg": "#1a0033",
      "--text": "#e0ccff",
      "--user-bubble": "#330066",
      "--ai-bubble": "#4b0082"
    }
  };

  // Load custom themes
  customThemes.forEach(t => (themes[t.name] = t.colors));
  updateThemeSelector();

  function updateThemeSelector() {
    themeSelector.innerHTML = "";
    for (const name in themes) {
      const opt = document.createElement("option");
      opt.value = name;
      opt.textContent = name.charAt(0).toUpperCase() + name.slice(1);
      themeSelector.appendChild(opt);
    }
  }

  function applyTheme(name) {
    const t = themes[name];
    if (!t) return;
    Object.entries(t).forEach(([k, v]) => root.style.setProperty(k, v));
    typingIndicator.style.color = t["--text"];
  }

  themeSelector.addEventListener("change", () => {
    const selected = themeSelector.value;
    applyTheme(selected);
    localStorage.setItem("theme", selected);
  });

  const savedTheme = localStorage.getItem("theme") || "default";
  themeSelector.value = savedTheme;
  applyTheme(savedTheme);

  // === MODS MENU ===
  modsBtn.addEventListener("click", openCustomThemeCreator);

  function openCustomThemeCreator() {
    const modal = document.createElement("div");
    modal.className =
      "fixed inset-0 flex items-center justify-center bg-black bg-opacity-60 z-50";
    modal.innerHTML = `
      <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-2xl max-w-md w-full text-gray-900 dark:text-white transition-all duration-300">
        <h2 class="text-xl font-bold mb-4 text-center">Create Custom Theme</h2>
        <label class="block mb-2">Theme Name:</label>
        <input id="themeName" class="w-full mb-3 p-2 rounded bg-gray-100 dark:bg-gray-700" placeholder="MyTheme" />
        <label class="block mb-2">Background:</label>
        <input type="color" id="bgColor" class="w-full mb-3">
        <label class="block mb-2">Text Color:</label>
        <input type="color" id="textColor" class="w-full mb-3">
        <label class="block mb-2">User Bubble:</label>
        <input type="color" id="userColor" class="w-full mb-3">
        <label class="block mb-2">AI Bubble:</label>
        <input type="color" id="aiColor" class="w-full mb-4">
        <div class="flex justify-between">
          <button id="previewTheme" class="px-3 py-2 bg-blue-600 text-white rounded">Preview</button>
          <button id="saveTheme" class="px-3 py-2 bg-green-600 text-white rounded">Save</button>
          <button id="cancelTheme" class="px-3 py-2 bg-gray-500 text-white rounded">Cancel</button>
        </div>
      </div>
    `;
    document.body.appendChild(modal);

    modal.querySelector("#cancelTheme").onclick = () => modal.remove();

    modal.querySelector("#previewTheme").onclick = () => {
      const colors = getThemeInputs();
      Object.entries(colors).forEach(([k, v]) => root.style.setProperty(k, v));
    };

    modal.querySelector("#saveTheme").onclick = () => {
      const name = modal.querySelector("#themeName").value.trim() || "Custom";
      const colors = getThemeInputs();
      const newTheme = { name, colors };
      customThemes.push(newTheme);
      localStorage.setItem("customThemes", JSON.stringify(customThemes));
      themes[name] = colors;
      updateThemeSelector();
      themeSelector.value = name;
      applyTheme(name);
      modal.remove();
    };

    function getThemeInputs() {
      return {
        "--bg": modal.querySelector("#bgColor").value,
        "--text": modal.querySelector("#textColor").value,
        "--user-bubble": modal.querySelector("#userColor").value,
        "--ai-bubble": modal.querySelector("#aiColor").value
      };
    }
  }

  // === ANIMATIONS ===
  chatBox.style.transition = "background 0.4s ease, color 0.4s ease";
  typingIndicator.style.transition = "color 0.4s ease";
});
</script>
</body>
</html>
