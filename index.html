<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>JIAICB (v0.78+)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<style>
:root {
  --bg:#111;
  --text:#eee;
  --accent:#4ea1ff;
  --ai:#1a1a1a;
  --user:#222;
  --bubble-radius:16px;
  --transition:0.35s ease;
}
body {
  font-family: "Segoe UI", sans-serif;
  background: var(--bg);
  color: var(--text);
  display:flex;
  flex-direction:column;
  height:100vh;
  margin:0;
}
#chat {
  flex:1;
  overflow-y:auto;
  padding:15px;
}
.message {
  max-width:80%;
  padding:10px 14px;
  margin:6px 0;
  border-radius:var(--bubble-radius);
  line-height:1.4;
  word-wrap:break-word;
  white-space:pre-wrap;
}
.message.user {
  align-self:flex-end;
  background:var(--accent);
  color:#fff;
  border-bottom-right-radius:4px;
}
.message.ai {
  align-self:flex-start;
  background:var(--ai);
  border-bottom-left-radius:4px;
}
#input-area {
  display:flex;
  gap:8px;
  padding:10px;
  background:#0008;
  border-top:1px solid #333;
}
#prompt {
  flex:1;
  resize:none;
  border:none;
  padding:10px;
  border-radius:8px;
  background:#222;
  color:var(--text);
}
button {
  background:var(--accent);
  border:none;
  color:#fff;
  font-weight:600;
  border-radius:8px;
  padding:8px 14px;
  cursor:pointer;
  transition:var(--transition);
}
button:hover{opacity:0.8}

/* typing indicator */
.typing {
  display:inline-flex;
  gap:4px;
  padding:6px 10px;
}
.typing span {
  width:8px;
  height:8px;
  border-radius:50%;
  background:var(--accent);
  animation: blink 1.2s infinite ease-in-out;
}
.typing span:nth-child(2){animation-delay:0.2s;}
.typing span:nth-child(3){animation-delay:0.4s;}
@keyframes blink {
  0%,80%,100%{opacity:0.3;}
  40%{opacity:1;}
}

/* theme selector */
#theme {
  position:absolute;
  top:10px;right:10px;
  background:#222;
  color:#fff;
  border-radius:8px;
  border:1px solid #333;
  padding:5px;
}

/* ====== RIP Modal ====== */
#ripBtn {
  position:absolute;
  bottom:15px;left:15px;
  z-index:100;
}
.modal {
  display:none;
  position:fixed;
  z-index:9999;
  left:0;top:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.6);
  justify-content:center;
  align-items:center;
}
.modal-content {
  background:var(--ai);
  color:var(--text);
  border-radius:12px;
  padding:20px;
  width:80%;
  max-width:700px;
  max-height:90%;
  overflow-y:auto;
  box-shadow:0 0 25px rgba(0,0,0,0.4);
}
.close {
  float:right;
  font-size:24px;
  cursor:pointer;
  color:var(--text);
}
.modal-tabs {
  display:flex;
  gap:8px;
  margin:15px 0;
}
.rip-tab {
  background:transparent;
  color:var(--text);
  border:1px solid var(--accent);
  border-radius:8px;
  padding:6px 12px;
  cursor:pointer;
}
.rip-tab.active {
  background:var(--accent);
  color:#fff;
}
#historyContainer iframe {
  width:100%;
  height:400px;
  border:none;
  border-radius:10px;
}
</style>
</head>
<body>
<select id="theme">
  <option value="blue">Blue</option>
  <option value="light">Light</option>
  <option value="dark">Dark</option>
  <option value="sunset">Sunset</option>
</select>

<div id="chat"></div>

<div id="input-area">
  <textarea id="prompt" rows="1" placeholder="Type a message..."></textarea>
  <button id="sendBtn">Send</button>
</div>

<button id="ripBtn">RIP</button>

<!-- ðŸ’€ RIP Modal -->
<div id="ripModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>RIP â€” History & Info</h2>
    <div class="modal-tabs">
      <button class="rip-tab active" data-tab="logs">Logs</button>
      <button class="rip-tab" data-tab="credits">Credits</button>
      <button class="rip-tab" data-tab="version">Version</button>
    </div>
    <div id="logsSection">
      <p>Session log started at: <span id="sessionTime"></span></p>
      <p>System active and ready.</p>
    </div>
    <div id="creditsSection" style="display:none;">
      <p>Made with <3 by <b>Jerich</b></p>
      <p>Version: JIAICB v0.78+</p>
    </div>
    <div id="versionSection" style="display:none;">
      <p id="versionInfo"></p>
      <button id="viewHistoryBtn">View Server History</button>
      <div id="historyContainer" style="display:none;margin-top:10px;"></div>
    </div>
  </div>
</div>

<script>
// ---------- Setup ----------
marked.setOptions({ gfm: true, breaks: true });
if (!localStorage.getItem("deviceId"))
  localStorage.setItem("deviceId", crypto.randomUUID());
const deviceId = localStorage.getItem("deviceId");
const chat = document.getElementById("chat");
const promptEl = document.getElementById("prompt");
const sendBtn = document.getElementById("sendBtn");

// ---------- Functions ----------
function addMessage(cls, sender, text) {
  const msg = document.createElement("div");
  msg.className = "message " + cls;
  msg.innerHTML = marked.parse(text);
  chat.appendChild(msg);
  chat.scrollTop = chat.scrollHeight;
}
function showTyping() {
  const wrap = document.createElement("div");
  wrap.className = "message ai";
  wrap.id = "typing";
  wrap.innerHTML = `<div class="typing"><span></span><span></span><span></span></div>`;
  chat.appendChild(wrap);
  chat.scrollTop = chat.scrollHeight;
}
function hideTyping() {
  const t = document.getElementById("typing");
  if (t) t.remove();
}

// ---------- Send ----------
sendBtn.onclick = async () => {
  const input = promptEl.value.trim();
  if (!input) return;
  addMessage("user","You",input);
  promptEl.value = "";
  showTyping();
  try {
    const res = await fetch(`/api?device=${deviceId}&input=${encodeURIComponent(input)}`);
    const text = await res.text();
    hideTyping();
    addMessage("ai","AI",text);
  } catch(e){
    hideTyping();
    addMessage("ai","AI","Error: "+e);
  }
};

// ---------- Theme ----------
const themeSel = document.getElementById("theme");
themeSel.onchange = () => setTheme(themeSel.value);
function setTheme(t) {
  switch(t){
    case "light":
      document.documentElement.style.setProperty("--bg","#f7f7f7");
      document.documentElement.style.setProperty("--text","#111");
      document.documentElement.style.setProperty("--ai","#e0e0e0");
      document.documentElement.style.setProperty("--user","#007bff");
      document.documentElement.style.setProperty("--accent","#007bff");
      break;
    case "dark":
      document.documentElement.style.setProperty("--bg","#111");
      document.documentElement.style.setProperty("--text","#eee");
      document.documentElement.style.setProperty("--ai","#1a1a1a");
      document.documentElement.style.setProperty("--user","#222");
      document.documentElement.style.setProperty("--accent","#4ea1ff");
      break;
    case "sunset":
      document.documentElement.style.setProperty("--bg","#2b1d29");
      document.documentElement.style.setProperty("--text","#ffd1dc");
      document.documentElement.style.setProperty("--ai","#3a2638");
      document.documentElement.style.setProperty("--user","#ff6b6b");
      document.documentElement.style.setProperty("--accent","#ff8c42");
      break;
    default:
      document.documentElement.style.setProperty("--bg","#0b1622");
      document.documentElement.style.setProperty("--text","#eaf6ff");
      document.documentElement.style.setProperty("--ai","#142a3f");
      document.documentElement.style.setProperty("--user","#1b3b5a");
      document.documentElement.style.setProperty("--accent","#4ea1ff");
  }
}
setTheme("blue");

// ---------- RIP Modal ----------
const ripBtn=document.getElementById("ripBtn"),
      ripModal=document.getElementById("ripModal"),
      ripClose=ripModal.querySelector(".close"),
      ripTabs=ripModal.querySelectorAll(".rip-tab"),
      logsSection=document.getElementById("logsSection"),
      creditsSection=document.getElementById("creditsSection"),
      versionSection=document.getElementById("versionSection"),
      versionInfoEl=document.getElementById("versionInfo"),
      viewHistoryBtn=document.getElementById("viewHistoryBtn"),
      historyContainer=document.getElementById("historyContainer"),
      sessionTime=document.getElementById("sessionTime");

ripBtn.onclick=()=>{
  ripModal.style.display="flex";
  ripTabs.forEach(t=>t.classList.remove("active"));
  ripTabs[0].classList.add("active");
  logsSection.style.display="block";
  creditsSection.style.display="none";
  versionSection.style.display="none";
  historyContainer.style.display="none";
  sessionTime.textContent=new Date().toLocaleString();
};
ripClose.onclick=()=>ripModal.style.display="none";
window.onclick=e=>{if(e.target===ripModal)ripModal.style.display="none";}
ripTabs.forEach(tab=>{
  tab.onclick=()=>{
    ripTabs.forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    const name=tab.dataset.tab;
    logsSection.style.display=(name==="logs")?"block":"none";
    creditsSection.style.display=(name==="credits")?"block":"none";
    versionSection.style.display=(name==="version")?"block":"none";
    historyContainer.style.display="none";
  };
});
versionInfoEl.textContent="Build "+new Date().toLocaleDateString();
viewHistoryBtn.onclick=()=>{
  if(historyContainer.style.display==="none"){
    historyContainer.innerHTML=`<iframe src="https://jiaicb.onrender.com/history/"
      style="width:100%;height:400px;border:0;border-radius:10px;background:#111;"></iframe>`;
    historyContainer.style.display="block";
  }else historyContainer.style.display="none";
};
</script>
</body>
</html>
